name: Release Pipeline

on:
  push:
    branches:
      - main

permissions:
  contents: write
  pull-requests: write

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
        # Checkout code with full history
        - name: Checkout Repository
          uses: actions/checkout@v4
          with:
            fetch-depth: 0
        
        # Setup node js
        - name: Setup Node js
          uses: actions/setup-node@v4
          with:
            node-version: '22.x'
        
        # Configure Github Bot Identity
        - name: Configure Github Bot Identity
          run: |
            git config user.name "github-actions[bot]"
            git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
        
        # Install dependencies
        - name: Install Dependencies
          run: yarn install --frozen-lockfile
        
        # Build 
        - name: Build Package
          run: yarn build
        
        # Set Version
        - name: Set Version
          id: set_version
          run: echo "version=0.0.${{ github.run_number }}" >> $GITHUB_OUTPUT
        
        # Create Git Tag
        - name: Create Git Tag
          run: |
            git tag v${{ steps.set_version.outputs.version }}
            git push origin v${{ steps.set_version.outputs.version }}
        
        #  Create Github Release
        - name: Create Github Release
          id: create_release
          uses: softprops/action-gh-release@v1
          with:
            tag_name: v${{ steps.set_version.outputs.version }}
            name: Release v${{steps.set_version.outputs.version}}
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}


    